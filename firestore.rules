// أعلى الملف:
import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from 'firebase/auth'
import { app } from '@/lib/firebase' // أو حيثما تهيّئ Firebase

// داخل useEffect أول ما تفتح صفحة الأدمن:
useEffect(() => {
  const auth = getAuth(app)
  const unsub = onAuthStateChanged(auth, async (user) => {
    if (!user) {
      // افتح نافذة تسجيل بواسطة جوجل بسرعة
      try {
        await signInWithPopup(auth, new GoogleAuthProvider())
        console.log('Signed in')
      } catch (e) {
        console.error('Login failed', e)
        alert('يلزم تسجيل الدخول لاستخدام لوحة التحكم')
      }
    } else {
      console.log('Logged in as', user.uid, user.email)
    }
  })
  return () => unsub()
}, [])
